<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Fine-grained PAT Helper</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1, h2 {
            color: #0969da;
        }
        .bookmarklet-button {
            display: inline-block;
            background: #0969da;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            margin: 10px 0;
        }
        .bookmarklet-button:hover {
            background: #0860ca;
        }
        .preset {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            background: #f6f8fa;
        }
        .preset h3 {
            margin-top: 0;
            color: #0969da;
        }
        .preset button {
            background: #2ea44f;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .preset button:hover {
            background: #2c974b;
        }
        code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 85%;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        .instructions {
            background: #ddf4ff;
            border: 1px solid #54a3ff;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        .config-builder {
            background: #f6f8fa;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        .permission-group {
            margin: 15px 0;
        }
        .permission-group label {
            display: block;
            margin: 5px 0;
        }
        select {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin-left: 10px;
        }
        #generated-code {
            background: #1b1f23;
            color: #e1e4e8;
            padding: 15px;
            border-radius: 6px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>GitHub Fine-grained PAT Helper</h1>
    
    <div class="instructions">
        <h2>🚀 Quick Start</h2>
        <p><strong>Drag this button to your bookmarks bar:</strong></p>
        <a href="javascript:(function(){window.ghPat={setPermission:function(resourceName,accessLevel){const permissionRows=document.querySelectorAll('li.js-list-group-item');for(const row of permissionRows){const buttons=row.querySelectorAll('button[data-resource]');for(const button of buttons){if(button.getAttribute('data-resource')===resourceName){const dropdownButton=row.querySelector('.js-action-selection-list-menu-button');if(!dropdownButton){console.error(`Dropdown button not found for ${resourceName}`);return false;}dropdownButton.click();setTimeout(()=>{const targetButton=row.querySelector(`button[data-resource=&quot;${resourceName}&quot;][data-value=&quot;${accessLevel}&quot;]`);if(targetButton){targetButton.click();console.log(`Set ${resourceName} to ${accessLevel}`);}else{console.error(`Button not found for ${resourceName} with ${accessLevel} access`);}},100);return true;}}}console.error(`Permission ${resourceName} not found`);return false;},setMultiplePermissions:function(permissions){let delay=0;for(const[resource,access]of Object.entries(permissions)){setTimeout(()=>{this.setPermission(resource,access);},delay);delay+=200;}},listAvailablePermissions:function(){const permissions={};const permissionRows=document.querySelectorAll('li.js-list-group-item');permissionRows.forEach(row=>{const titleElement=row.querySelector('strong');if(!titleElement)return;const permissionTitle=titleElement.textContent.trim();const resourceButton=row.querySelector('button[data-resource]');if(!resourceButton)return;const resourceName=resourceButton.getAttribute('data-resource');const resourceParent=resourceButton.getAttribute('data-resource-parent');const currentButton=row.querySelector('.js-action-selection-list-menu-button');let currentAccess='none';if(currentButton){const buttonText=currentButton.textContent.trim();if(buttonText.includes('Read and write'))currentAccess='write';else if(buttonText.includes('Read-only'))currentAccess='read';else if(buttonText.includes('No access'))currentAccess='none';}const availableLevels=[];row.querySelectorAll('button[data-value]').forEach(btn=>{const value=btn.getAttribute('data-value');if(value)availableLevels.push(value);});permissions[resourceName]={title:permissionTitle,parent:resourceParent,currentAccess:currentAccess,availableLevels:[...new Set(availableLevels)]};});console.log('Available permissions:');console.table(permissions);return permissions;},getCurrentPermissions:function(){const permissions=this.listAvailablePermissions();const current={};for(const[resource,info]of Object.entries(permissions)){if(info.currentAccess!=='none'){current[resource]=info.currentAccess;}}console.log('Current non-zero permissions:');console.log(current);return current;},setRepositoryAccess:function(accessType){const radioButtons={'none':document.getElementById('install_target_none'),'all':document.getElementById('install_target_all'),'selected':document.getElementById('install_target_selected')};const targetRadio=radioButtons[accessType];if(!targetRadio){console.error(`Invalid repository access type: ${accessType}. Use 'none', 'all', or 'selected'`);return false;}targetRadio.click();console.log(`Set repository access to: ${accessType}`);if(accessType==='selected'){console.log('Note: You will need to select specific repositories manually or use selectRepositories() function');}return true;},getRepositoryAccess:function(){const radioButtons=document.querySelectorAll('input[name=&quot;install_target&quot;]');for(const radio of radioButtons){if(radio.checked){const value=radio.value;let description='';switch(value){case'none':description='Public repositories only (read-only)';break;case'all':description='All repositories (current and future)';break;case'selected':description='Selected repositories only';break;}console.log(`Current repository access: ${value} - ${description}`);return value;}}console.log('No repository access type selected');return null;},selectRepositories:function(repoNames){console.log('Note: This function now processes repositories sequentially. Please wait for completion.');if(this.getRepositoryAccess()!=='selected'){console.log('Setting repository access to &quot;selected&quot; first...');this.setRepositoryAccess('selected');}setTimeout(()=>{const selectButton=document.querySelector('#repository-menu-list-button');if(!selectButton){console.error('Repository picker button not found');return;}selectButton.click();console.log('Opening repository picker...');setTimeout(()=>{this.clearAllRepositories();let currentIndex=0;const processNextRepo=()=>{if(currentIndex>=repoNames.length){setTimeout(()=>{const closeButton=document.querySelector('[data-close-dialog-id=&quot;repository-menu-list-dialog&quot;]');if(closeButton){closeButton.click();}else{const dialog=document.querySelector('#repository-menu-list-dialog');if(dialog){document.body.click();}}console.log('Repository selection completed');},500);return;}const repoName=repoNames[currentIndex];console.log(`Processing repository ${currentIndex+1}/${repoNames.length}: ${repoName}`);const searchInput=document.querySelector('#repository-menu-list-filter');if(!searchInput){console.error('Search input not found');return;}searchInput.value='';searchInput.dispatchEvent(new Event('input',{bubbles:true}));searchInput.value=repoName;searchInput.dispatchEvent(new Event('input',{bubbles:true}));let retries=0;const maxRetries=5;const trySelect=()=>{const repoButtons=document.querySelectorAll('button[role=&quot;option&quot;]');let found=false;for(const button of repoButtons){if(button.textContent.trim().includes(repoName)){button.click();console.log(`Selected: ${repoName}`);found=true;currentIndex++;setTimeout(processNextRepo,800);break;}}if(!found){retries++;if(retries<maxRetries){console.log(`Retrying ${repoName} (${retries}/${maxRetries})...`);setTimeout(trySelect,300);}else{console.error(`Failed to find: ${repoName}`);currentIndex++;setTimeout(processNextRepo,300);}}};setTimeout(trySelect,500);};setTimeout(processNextRepo,1000);},1500);},500);},addRepository:function(repoName){console.log('Note: Use selectRepositories() for better sequential processing');},clearAllRepositories:function(){const removeButtons=document.querySelectorAll('.js-repository-picker-remove');removeButtons.forEach(button=>{button.click();});console.log(`Cleared ${removeButtons.length} repositories`);},getSelectedRepositories:function(){const selectedRepos=[];const repoElements=document.querySelectorAll('.js-repository-picker-result .repo-and-owner');repoElements.forEach(element=>{const repoName=element.textContent.trim();selectedRepos.push(repoName);});console.log('Currently selected repositories:');console.log(selectedRepos);return selectedRepos;}};console.log('GitHub PAT Helper loaded! Available functions:');console.log('- ghPat.setPermission(resource, level)');console.log('- ghPat.setMultiplePermissions({resource: level, ...})');console.log('- ghPat.listAvailablePermissions()');console.log('- ghPat.getCurrentPermissions()');console.log('- ghPat.setRepositoryAccess(type)');console.log('- ghPat.getRepositoryAccess()');console.log('- ghPat.selectRepositories([repo1, repo2, ...])');console.log('- ghPat.clearAllRepositories()');console.log('- ghPat.getSelectedRepositories()');})();" class="bookmarklet-button">GitHub PAT Helper</a>
        
        <ol>
            <li>Navigate to <a href="https://github.com/settings/personal-access-tokens/new" target="_blank">GitHub's PAT creation page</a></li>
            <li>Click the bookmarklet in your bookmarks bar</li>
            <li>Use the developer console to run commands</li>
        </ol>
    </div>

    <h2>📋 Preset Configurations</h2>
    
    <div class="preset">
        <h3>CI/CD Token (Read-only)</h3>
        <p>Suitable for continuous integration workflows that need to read code and download packages.</p>
        <pre><code>ghPat.setTokenName('CI/CD Read-only Token');
ghPat.setTokenDescription('Automated CI/CD workflow - read access only');
ghPat.setExpiration(30); // 30 days expiration
ghPat.setRepositoryAccess('all');
ghPat.setMultiplePermissions({
  'contents': 'read',
  'metadata': 'read',
  'packages': 'read'
});</code></pre>
        <button onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy Code</button>
    </div>

    <div class="preset">
        <h3>Organization Token</h3>
        <p>Token for organization repositories with specific permissions.</p>
        <pre><code>ghPat.setResourceOwner('my-org'); // Set organization
ghPat.setExpiration(30);
ghPat.setRepositoryAccess('selected');
ghPat.setMultiplePermissions({
  'contents': 'write',
  'pull_requests': 'write',
  'issues': 'read',
  'metadata': 'read'
});</code></pre>
        <button onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy Code</button>
    </div>

    <div class="preset">
        <h3>Development Token</h3>
        <p>For local development with ability to push code and manage issues/PRs.</p>
        <pre><code>ghPat.setExpiration(7); // 7 days for security
ghPat.setRepositoryAccess('selected');
ghPat.setMultiplePermissions({
  'contents': 'write',
  'issues': 'write',
  'pull_requests': 'write',
  'metadata': 'read'
});</code></pre>
        <button onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy Code</button>
    </div>

    <div class="preset">
        <h3>Release Automation</h3>
        <p>For automated release workflows that need to create releases and upload packages.</p>
        <pre><code>ghPat.setExpiration(90); // 90 days for automation
ghPat.setRepositoryAccess('selected');
ghPat.setMultiplePermissions({
  'contents': 'write',
  'packages': 'write',
  'metadata': 'read',
  'actions': 'read'
});</code></pre>
        <button onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy Code</button>
    </div>

    <div class="preset">
        <h3>Long-term Service Token</h3>
        <p>For services that need extended access (use with caution).</p>
        <pre><code>// Set custom expiration 6 months from now
const sixMonths = new Date();
sixMonths.setMonth(sixMonths.getMonth() + 6);
const dateStr = sixMonths.toISOString().split('T')[0];

ghPat.setExpiration('custom', dateStr);
ghPat.setRepositoryAccess('selected');
ghPat.setMultiplePermissions({
  'contents': 'read',
  'metadata': 'read'
});</code></pre>
        <button onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy Code</button>
    </div>

    <div class="preset">
        <h3>Admin Token</h3>
        <p>Full access for repository administration (use sparingly and rotate frequently).</p>
        <pre><code>ghPat.setExpiration(7); // Short expiration for admin tokens!
ghPat.setRepositoryAccess('selected');
ghPat.setMultiplePermissions({
  'administration': 'write',
  'contents': 'write',
  'issues': 'write',
  'pull_requests': 'write',
  'packages': 'write',
  'metadata': 'read'
});</code></pre>
        <button onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy Code</button>
    </div>

    <h2>🛠️ Custom Configuration Builder</h2>
    <div class="config-builder">
        <h3>Build Your Own Configuration</h3>
        
        <div class="permission-group">
            <label>Resource Owner:
                <input type="text" id="resource-owner" value="" placeholder="e.g., haya14busa or my-org" onchange="updateGeneratedCode()" style="padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px; margin-left: 10px; width: 200px;">
            </label>
            <small style="display: block; margin-left: 110px; color: #666;">Leave empty to use current user</small>
        </div>
        
        <div class="permission-group">
            <label>Repository Access:
                <select id="repo-access" onchange="updateGeneratedCode()">
                    <option value="none">Public repositories only</option>
                    <option value="all">All repositories</option>
                    <option value="selected">Selected repositories</option>
                </select>
            </label>
        </div>

        <div class="permission-group">
            <label>Token Expiration:
                <select id="token-expiration" onchange="updateGeneratedCode(); toggleCustomDate()">
                    <option value="7">7 days</option>
                    <option value="30" selected>30 days</option>
                    <option value="60">60 days</option>
                    <option value="90">90 days</option>
                    <option value="custom">Custom</option>
                    <option value="none">No expiration</option>
                </select>
            </label>
            <label id="custom-date-group" style="display: none; margin-left: 10px;">
                Custom Date:
                <input type="date" id="custom-date" onchange="updateGeneratedCode()" style="padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px;">
            </label>
        </div>

        <h4>Permissions:</h4>
        <div id="permissions-list">
            <div class="permission-group">
                <label>Contents:
                    <select data-permission="contents" onchange="updateGeneratedCode()">
                        <option value="none">No access</option>
                        <option value="read">Read</option>
                        <option value="write">Write</option>
                    </select>
                </label>
            </div>
            <div class="permission-group">
                <label>Issues:
                    <select data-permission="issues" onchange="updateGeneratedCode()">
                        <option value="none">No access</option>
                        <option value="read">Read</option>
                        <option value="write">Write</option>
                    </select>
                </label>
            </div>
            <div class="permission-group">
                <label>Pull requests:
                    <select data-permission="pull_requests" onchange="updateGeneratedCode()">
                        <option value="none">No access</option>
                        <option value="read">Read</option>
                        <option value="write">Write</option>
                    </select>
                </label>
            </div>
            <div class="permission-group">
                <label>Packages:
                    <select data-permission="packages" onchange="updateGeneratedCode()">
                        <option value="none">No access</option>
                        <option value="read">Read</option>
                        <option value="write">Write</option>
                    </select>
                </label>
            </div>
            <div class="permission-group">
                <label>Actions:
                    <select data-permission="actions" onchange="updateGeneratedCode()">
                        <option value="none">No access</option>
                        <option value="read">Read</option>
                        <option value="write">Write</option>
                    </select>
                </label>
            </div>
            <div class="permission-group">
                <label>Administration:
                    <select data-permission="administration" onchange="updateGeneratedCode()">
                        <option value="none">No access</option>
                        <option value="read">Read</option>
                        <option value="write">Write</option>
                    </select>
                </label>
            </div>
            <div class="permission-group">
                <label>Metadata:
                    <select data-permission="metadata" onchange="updateGeneratedCode()">
                        <option value="none">No access</option>
                        <option value="read" selected>Read</option>
                    </select>
                </label>
            </div>
        </div>

        <h4>Generated Code:</h4>
        <pre id="generated-code"></pre>
        <button onclick="copyToClipboard(document.getElementById('generated-code').textContent)">Copy Code</button>
        
        <h4 style="margin-top: 20px;">Shareable URL:</h4>
        <pre id="generated-url" style="word-wrap: break-word; white-space: pre-wrap;"></pre>
        <button onclick="copyToClipboard(document.getElementById('generated-url').textContent)">Copy URL</button>
    </div>

    <h2>📚 Usage Guide</h2>
    <h3>Available Functions</h3>
    <ul>
        <li><code>ghPat.setTokenName(name)</code> - Set the token name</li>
        <li><code>ghPat.getTokenName()</code> - Get current token name</li>
        <li><code>ghPat.setTokenDescription(description)</code> - Set the token description</li>
        <li><code>ghPat.getTokenDescription()</code> - Get current token description</li>
        <li><code>ghPat.setPermission(resource, level)</code> - Set a single permission</li>
        <li><code>ghPat.setMultiplePermissions({resource: level, ...})</code> - Set multiple permissions at once</li>
        <li><code>ghPat.listAvailablePermissions()</code> - List all available permissions on the page</li>
        <li><code>ghPat.getCurrentPermissions()</code> - Get current permission settings</li>
        <li><code>ghPat.setRepositoryAccess(type)</code> - Set repository access type ('none', 'all', or 'selected')</li>
        <li><code>ghPat.getRepositoryAccess()</code> - Get current repository access setting</li>
        <li><code>ghPat.selectRepositories([repo1, repo2, ...])</code> - Select specific repositories</li>
        <li><code>ghPat.clearAllRepositories()</code> - Clear all selected repositories</li>
        <li><code>ghPat.getSelectedRepositories()</code> - Get list of currently selected repositories</li>
        <li><code>ghPat.setExpiration(days)</code> - Set token expiration (7, 30, 60, 90, 'custom', or 'none')</li>
        <li><code>ghPat.setExpiration('custom', 'YYYY-MM-DD')</code> - Set custom expiration date</li>
        <li><code>ghPat.setCustomExpirationDate('YYYY-MM-DD')</code> - Set date after selecting custom</li>
        <li><code>ghPat.getExpiration()</code> - Get current expiration setting</li>
        <li><code>ghPat.setResourceOwner('owner-name')</code> - Set resource owner (user or organization)</li>
        <li><code>ghPat.getResourceOwner()</code> - Get current resource owner</li>
        <li><code>ghPat.getAvailableResourceOwners()</code> - List available resource owners</li>
        <li><code>ghPat.applyFromUrlParams()</code> - Apply configuration from URL parameters</li>
        <li><code>ghPat.generateConfigUrl()</code> - Generate URL with current configuration</li>
        <li><code>ghPat.copyConfigUrl()</code> - Copy configuration URL to clipboard</li>
        <li><code>ghPat.openConfigUrl()</code> - Open configuration URL in new tab</li>
        <li><code>ghPat.updateUrlParams()</code> - Update current URL with configuration (no reload)</li>
    </ul>

    <h3>URL Parameter Configuration</h3>
    <p>You can share token configurations using URL parameters. The tool will automatically detect and offer to apply them.</p>
    
    <h4>Example URL</h4>
    <pre><code>https://github.com/settings/personal-access-tokens/new?name=CI+Token&expiration=30&repo_access=all&permissions=contents:read,metadata:read</code></pre>
    
    <h4>Supported Parameters</h4>
    <ul>
        <li><code>name</code> - Token name</li>
        <li><code>description</code> - Token description</li>
        <li><code>owner</code> - Resource owner</li>
        <li><code>expiration</code> - Expiration (7, 30, 60, 90, custom, none)</li>
        <li><code>expiration_date</code> - Custom date (YYYY-MM-DD)</li>
        <li><code>repo_access</code> - Repository access (none, all, selected)</li>
        <li><code>repos</code> - Repositories (comma-separated)</li>
        <li><code>permissions</code> - Permissions (format: resource:level,resource:level)</li>
    </ul>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Code copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        function updateGeneratedCode() {
            const resourceOwner = document.getElementById('resource-owner').value.trim();
            const expiration = document.getElementById('token-expiration').value;
            const repoAccess = document.getElementById('repo-access').value;
            const permissions = {};
            
            document.querySelectorAll('[data-permission]').forEach(select => {
                const permission = select.getAttribute('data-permission');
                const value = select.value;
                if (value !== 'none') {
                    permissions[permission] = value;
                }
            });

            // Generate code
            let code = '';
            
            // Add resource owner if specified
            if (resourceOwner) {
                code += `ghPat.setResourceOwner('${resourceOwner}');\n`;
            }
            
            // Add expiration setting
            if (expiration === 'none') {
                code += `ghPat.setExpiration('${expiration}');\n`;
            } else if (expiration === 'custom') {
                const customDate = document.getElementById('custom-date').value;
                if (customDate) {
                    code += `ghPat.setExpiration('custom', '${customDate}');\n`;
                } else {
                    code += `ghPat.setExpiration('custom'); // Set date manually\n`;
                }
            } else {
                code += `ghPat.setExpiration(${expiration});\n`;
            }
            
            code += `ghPat.setRepositoryAccess('${repoAccess}');\n`;
            
            if (Object.keys(permissions).length > 0) {
                code += 'ghPat.setMultiplePermissions({\n';
                const permEntries = Object.entries(permissions).map(([key, value]) => 
                    `  '${key}': '${value}'`
                );
                code += permEntries.join(',\n');
                code += '\n});';
            }

            document.getElementById('generated-code').textContent = code;
            
            // Generate shareable URL
            const params = new URLSearchParams();
            const baseUrl = 'https://github.com/settings/personal-access-tokens/new';
            
            if (resourceOwner) {
                params.set('owner', resourceOwner);
            }
            
            if (expiration === 'none') {
                params.set('expiration', 'none');
            } else if (expiration === 'custom') {
                const customDate = document.getElementById('custom-date').value;
                if (customDate) {
                    params.set('expiration', 'custom');
                    params.set('expiration_date', customDate);
                }
            } else {
                params.set('expiration', expiration);
            }
            
            params.set('repo_access', repoAccess);
            
            if (Object.keys(permissions).length > 0) {
                const permsArray = Object.entries(permissions).map(([resource, level]) => `${resource}:${level}`);
                params.set('permissions', permsArray.join(','));
            }
            
            const shareableUrl = params.toString() ? `${baseUrl}?${params.toString()}` : baseUrl;
            document.getElementById('generated-url').textContent = shareableUrl;
        }

        function toggleCustomDate() {
            const expiration = document.getElementById('token-expiration').value;
            const customDateGroup = document.getElementById('custom-date-group');
            customDateGroup.style.display = expiration === 'custom' ? 'inline' : 'none';
            
            // Set default custom date to 30 days from now
            if (expiration === 'custom' && !document.getElementById('custom-date').value) {
                const futureDate = new Date();
                futureDate.setDate(futureDate.getDate() + 30);
                document.getElementById('custom-date').value = futureDate.toISOString().split('T')[0];
            }
        }

        // Initialize the code on page load
        updateGeneratedCode();
    </script>
</body>
</html>